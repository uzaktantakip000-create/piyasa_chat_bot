apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: piyasa-chatbot

resources:
  - namespace.yaml
  # configmap.yaml is replaced by configMapGenerator (see below)
  # - configmap.yaml
  # secret.yaml is NOT in git (security best practice)
  # Create manually: kubectl create secret generic piyasa-secrets --from-env-file=.env -n piyasa-chatbot
  # Or copy k8s/base/secret.yaml.template to secret.yaml and edit values
  # - secret.yaml  # Commented out - create manually!

  # PostgreSQL: Choose ONE (StatefulSet recommended for production)
  - postgres-deployment.yaml  # Simple Deployment (current, works but not best practice)
  # - postgres-statefulset.yaml  # StatefulSet (recommended, requires migration)

  - redis-statefulset.yaml
  - api-deployment.yaml
  - worker-statefulset.yaml
  - frontend-deployment.yaml
  - ingress.yaml
  - hpa.yaml

commonLabels:
  app.kubernetes.io/name: piyasa-chatbot
  app.kubernetes.io/version: "1.0.0"
  app.kubernetes.io/managed-by: kustomize

configMapGenerator:
  - name: piyasa-config
    literals:
      # LLM configuration
      - LLM_PROVIDER=openai
      - LLM_MODEL=gpt-4o-mini
      # Telegram configuration
      - TELEGRAM_API_BASE=https://api.telegram.org
      - TELEGRAM_TIMEOUT=30
      # Logging
      - LOG_LEVEL=INFO
      # Application settings
      - PORT=8000
      - TOTAL_WORKERS=4
      # Dashboard settings
      - DASHBOARD_STREAM_INTERVAL=5
      - DASHBOARD_STREAM_MAX_MESSAGES=20
      # Cache settings
      - CACHE_L1_MAX_SIZE=1000
      # Monitoring
      - PROMETHEUS_ENABLED=true
      - PROMETHEUS_PORT=9090
